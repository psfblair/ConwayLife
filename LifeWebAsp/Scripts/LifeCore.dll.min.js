(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k;$.Define($$,{Life:{Core:{cellState:function(l,m,n){return($.Tupled(function(o){var p,q,r,s,t,u,x,z,A;p=(q=(r=(s=o[0],(t=o[1],b.neighbors(s,t))),(u=function(v){return e.Filter(function(w){return v.Contains(w);},l);},u(r))),(x=function(y){return y.get_Count();},x(q)));z=(A=function(B){return B.Contains(o);},A(l));return[o,z,p];}))([m,n]);},neighborhood:function(C,D){var E,F,G,H,L;E=[C,D];F=E[1];G=E[0];H=f.toList(f.delay(function(){return f.collect(function(J){return f.map(function(K){return[G+J,F+K];},g.range(-1,1));},g.range(-1,1));}));L=function(M){var N;N=h.OfSeq(M);return i.New1(N);};return L(H);},neighbors:function(O,P){var Q,R,S,T,U;Q=[O,P];R=(S=Q[0],(T=Q[1],b.neighborhood(S,T)));U=function(V){return V.Remove(Q);};return U(R);},nextGeneration:function(W){var X,Y,Z,_0,_1,_9,bc,bd,bj,bp,bq;X=(Y=(Z=(_0=(_1=function(_2){var _3,_7,_8;_3=$.Tupled(function(_4){var _5,_6;_5=_4[0];_6=_4[1];return b.neighborhood(_5,_6);});_7=f.map(_3,_2);_8=h.OfSeq(_7);return i.New1(_8);},_1(W)),(_9=function(_){var ba,bb;ba=f.concat(_);bb=h.OfSeq(ba);return i.New1(bb);},_9(_0))),(bc=(bd=$.Tupled(function(be){var bf,bg;bf=be[0];bg=be[1];return b.cellState(W,bf,bg);}),function(bg){var bh,bi;bh=f.map(bd,bg);bi=h.OfSeq(bh);return i.New1(bi);}),bc(Z))),(bj=function(bk){return e.Filter($.Tupled(function(bl){var bm,bn,bo;bm=bl[0];bn=bl[1];bo=bl[2];return b.survives(bm,bn,bo);}),bk);},bj(Y)));bp=(bq=$.Tupled(function(br){var bs,bt,bu;bs=br[0];bt=br[1];bu=br[2];return bs;}),function(bv){var bw,bx;bw=f.map(bq,bv);bx=h.OfSeq(bw);return i.New1(bx);});return bp(X);},survives:function(by,bz,bA){var bB;bB=[by,bz,bA];if(bB[2]===2){if(bB[1]){return true;}else{return false;}}else{if(bB[2]===3){return true;}else{return false;}}}},Game:{addCell:function(bC,bD){var bE,bF;bE=[bC,bD];j.currentState().contents=(bF=j.currentState().contents,bF.Add(bE));},currentState:$.Field(function(){return{contents:i.New1(null)};}),generationLoop:function(bG){var bH,bJ;if(j.reset()){bH=function(){return k.Return(null);};return k.Delay(bH);}else{bJ=function(){var bL,bM;bL=k.Sleep(500);bM=function(){var bO,bP;j.newGeneration();bG(j.currentState().contents);bO=j.generationLoop(bG);bP=function(){return k.Return(null);};return k.Bind(bO,bP);};return k.Bind(bL,bM);};return k.Delay(bJ);}},isAlive:function(bR,bS){var bT,bU;bT=[bR,bS];bU=j.currentState().contents;return bU.Contains(bT);},newGeneration:function(){j.currentState().contents=b.nextGeneration(j.currentState().contents);},removeCell:function(bV,bW){var bX,bY;bX=[bV,bW];j.currentState().contents=(bY=j.currentState().contents,bY.Remove(bX));},reset:$.Field(function(){return false;}),resetAllCells:function(){j.currentState().contents=i.New1(null);},startDrawing:function(bZ){var b0,b1;j.reset=function(){return false;};b0=j.generationLoop(bZ);b1={$:0};return k.Start(b0);},stopDrawing:function(){j.reset=function(){return true;};},stopDrawingAndReset:function(b2){j.stopDrawing();j.resetAllCells();return b2(j.currentState().contents);},toggleCell:function(b3,b4){var b5,b6,b7,b8,b9,b_,b$;b5=[b3,b4];if(b6=b5[0],(b7=b5[1],j.isAlive(b6,b7))){b8=b5[0];b9=b5[1];return j.removeCell(b8,b9);}else{b_=b5[0];b$=b5[1];return j.addCell(b_,b$);}},toggleCellAndRedraw:function(ca,cb,cc){j.toggleCell(ca,cb);return cc(j.currentState().contents);}}}});$.OnInit(function(){a=$.Safe($$.Life);b=$.Safe(a.Core);c=$.Safe($$.IntelliFactory.WebSharper);d=$.Safe(c.Collections);e=$.Safe(d.SetModule);f=$.Safe(c.Seq);g=$.Safe(c.Operators);h=$.Safe(d.BalancedTree);i=$.Safe(d["FSharpSet`1"]);j=$.Safe(a.Game);return k=$.Safe(c.Concurrency);});$.OnLoad(function(){j.reset();j.currentState();});}());
