(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;$.Define($$,{LifeHtml:{Canvas:{GameEvents:$.Field(function(){return c.New();}),adjustInitArrayAndRedraw:function(w,x,y,z,A,B,C){var D,E;D=(C.clientX-A)/z>>0;E=(C.clientY-B)/z>>0;return e.toggleCellAndRedraw(D,E,function(F){return g.drawLife(w,x,y,z,F);});},canvas:$.Field(function(){var G;G=g.element();return G.Body;}),cellIsWithinViewableCanvas:function(H,I,J,K){return($.Tupled(function(L){if((L[0]>0?L[0]<h(H):false)?L[1]>0:false){return L[1]<h(I);}else{return false;}}))([J,K]);},context:$.Field(function(){return g.canvas().getContext("2d");}),drawLife:function(M,N,O,P,Q){var R,S,T,U,_1,_2,_7,_8;M.save();M.clearRect(0,0,h(N),h(O));M.fillStyle="#8EE5EE";M.fillRect(0,0,h(N),h(O));M.save();M.strokeStyle="black";M.fillStyle="black";M.lineWidth=1;R=(S=(T=(U=$.Tupled(function(V){var W,X;W=V[0];X=V[1];return g.transformCellCoordinatesToCanvasCoordinates(P,W,X);}),function(Y){var Z,_0;Z=i.map(U,Y);_0=k.OfSeq(Z);return l.New1(_0);}),T(Q)),(_1=(_2=$.Tupled(function(_3){var _4,_5;_4=_3[0];_5=_3[1];return g.cellIsWithinViewableCanvas(N,O,_4,_5);}),function(_6){return m.Filter(_2,_6);}),_1(S)));_7=(_8=$.Tupled(function(_9){var _,ba;_=_9[0];ba=_9[1];return g.drawSmallCircleAtPoint(M,P,_,ba);}),function(ba){return i.iter(_8,ba);});_7(R);return M.save();},drawSmallCircleAtPoint:function(bb,bc,bd,be){return($.Tupled(function(bf){var bg,bh;bg=(h(bc)-2)/2;bh=3.14159265358979*2;bb.beginPath();bb.arc(bf[0],bf[1],bg,0,bh,true);bb.closePath();return bb.stroke();}))([bd,be]);},element:$.Field(function(){var bi,bj;bi=p.Tags();bj=$.New(r,{$:0});return bi.NewTag("canvas",bj);}),initialize:function(bk,bl,bm,bn,bo){var bp,br;if(s.Equals((bp=g.canvas(),bp.getContext),undefined)){t.initElement(g.canvas());}g.canvas().width=bk;g.canvas().height=bl;g.context().canvas.addEventListener("click",function(bq){return g.adjustInitArrayAndRedraw(g.context(),bk,bl,bm,bn,bo,bq);},false);g.drawLife(g.context(),bk,bl,bm,e.currentState().contents);return u.addListener((br=g.GameEvents(),br.event),function(bs){if(bs.$==1){return e.stopDrawing();}else{if(bs.$==2){return e.stopDrawingAndReset(function(bt){return g.drawLife(g.context(),bk,bl,bm,bt);});}else{return e.startDrawing(function(bu){return g.drawLife(g.context(),bk,bl,bm,bu);});}}});},nodes:function(){var bv,bw;return v.add(o.Div(q.ofArray([o.Width($$.String(g.canvas().width)),(bv=o.Attr(),bv.NewAttr("style","float:left; clear:both"))])),q.ofArray([v.add(o.Div(q.ofArray([(bw=o.Attr(),bw.NewAttr("style","float:center"))])),q.ofArray([g.element()]))]));},transformCellCoordinatesToCanvasCoordinates:function(bx,by,bz){return($.Tupled(function(bA){var bB,bC,bD,bF,bG,bH;bB=(bC=bA[0]*bx+(bx/2>>0),(bD=function(bE){return h(bE);},bD(bC)));bF=(bG=bA[1]*bx+(bx/2>>0),(bH=function(bI){return h(bI);},bH(bG)));return[bB,bF];}))([by,bz]);}}}});$.OnInit(function(){a=$.Safe($$.IntelliFactory.WebSharper);b=$.Safe(a.Control);c=$.Safe(b["FSharpEvent`1"]);d=$.Safe($$.Life);e=$.Safe(d.Game);f=$.Safe($$.LifeHtml);g=$.Safe(f.Canvas);h=$.Safe($$.Number);i=$.Safe(a.Seq);j=$.Safe(a.Collections);k=$.Safe(j.BalancedTree);l=$.Safe(j["FSharpSet`1"]);m=$.Safe(j.SetModule);n=$.Safe(a.Html);o=$.Safe(n.Default);p=$.Safe(o.HTML5);q=$.Safe(a.List);r=$.Safe(q.T);s=$.Safe(a.Unchecked);t=$.Safe($$.G_vmlCanvasManager);u=$.Safe(a.Util);return v=$.Safe(n.Operators);});$.OnLoad(function(){g.element();g.context();g.canvas();g.GameEvents();});}());
