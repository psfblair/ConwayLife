(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;$.Define($$,{LifeHtml:{Canvas:{GameEvents:$.Field(function(){return c.New();}),adjustInitArrayAndRedraw:function(x){var y,z,A,B,F,G,J,K,L,P,Q;if(e.didNotMoveDuringClick(x)){y=(z=(A=e.canvasCoordinatesFromMouseEvent(x),(B=$.Tupled(function(C){var D,E;D=C[0];E=C[1];return e.transformPixelPairToCellPair(D,E);}),B(A))),(F=(G=function(H){return function(I){return H+I;};},(J=[e.cellXOffset(),e.cellYOffset()],(K=J[0],(L=J[1],$.Tupled(function(M){var N,O;N=M[0];O=M[1];return e.pairMap2(G,K,L,N,O);}))))),F(z)));P=y[0];Q=y[1];return g.toggleCellAndRedraw(P,Q,function(R){return e.drawLife(R);});}else{return null;}},canvas:$.Field(function(){var S;S=e.element();return S.Body;}),canvasCoordinatesFromMouseEvent:function(T){var U,V,W,X,_0,_1,_2,_6,_7;U=(V=[T.clientX,T.clientY],(W=(X=function(Y){return function(Z){return Y-Z;};},(_0=[e.canvasXOffset(),e.canvasYOffset()],(_1=_0[0],(_2=_0[1],$.Tupled(function(_3){var _4,_5;_4=_3[0];_5=_3[1];return e.pairMap2(X,_1,_2,_4,_5);}))))),W(V)));_6=(_7=function(_8){return h(_8);},$.Tupled(function(_9){var _,ba;_=_9[0];ba=_9[1];return e.pairMap(_7,_,ba);}));return _6(U);},canvasXOffset:$.Field(function(){return 0;}),canvasYOffset:$.Field(function(){return 0;}),cellIsWithinViewableCanvas:function(ba,bb){var bc,bd,bg,bh,bi,bj,bk,bo,bp;bc=[ba,bb];bd=function(be){return function(bf){if(be>0){return be<h(bf);}else{return false;}};};bg=(bh=(bi=[e.canvas().width,e.canvas().height],(bj=bi[0],(bk=bi[1],$.Tupled(function(bl){var bm,bn;bm=bl[0];bn=bl[1];return e.pairMap2(bd,bj,bk,bm,bn);})))),bh(bc));bo=bg[1];bp=bg[0];if(bp){return bo;}else{return false;}},cellSide:$.Field(function(){return 0;}),cellXOffset:$.Field(function(){return 0;}),cellYOffset:$.Field(function(){return 0;}),context:$.Field(function(){return e.canvas().getContext("2d");}),didNotMoveDuringClick:function(bq){var br,bt,bu,bv,bz,bA;br=function(bs){return i.abs(bs)<h(e.cellSide());};bt=(bu=e.pixelsMovedDuring(bq,e.mouseDownCanvasCoordinates()),(bv=$.Tupled(function(bw){var bx,by;bx=bw[0];by=bw[1];return e.pairMap(br,bx,by);}),bv(bu)));bz=bt[1];bA=bt[0];if(bA){return bz;}else{return false;}},drawLife:function(bB){var bC,bD,bE,bM,bR;e.context().save();e.context().clearRect(0,0,h(e.canvas().width),h(e.canvas().height));e.context().fillStyle="#8EE5EE";e.context().fillRect(0,0,h(e.canvas().width),h(e.canvas().height));e.context().save();e.context().strokeStyle="black";e.context().fillStyle="black";e.context().lineWidth=1;bC=(bD=(bE=function(bF){var bG,bK,bL;bG=$.Tupled(function(bH){var bI,bJ;bI=bH[0];bJ=bH[1];return e.transformCellCoordinatesToCanvasCoordinates(bI,bJ);});bK=j.map(bG,bF);bL=l.OfSeq(bK);return m.New1(bL);},bE(bB)),(bM=function(bN){return n.Filter($.Tupled(function(bO){var bP,bQ;bP=bO[0];bQ=bO[1];return e.cellIsWithinViewableCanvas(bP,bQ);}),bN);},bM(bD)));bR=function(bS){var bT;bT=$.Tupled(function(bU){var bV,bW;bV=bU[0];bW=bU[1];return e.drawSmallCircleAtPoint(bV,bW);});return j.iter(bT,bS);};bR(bC);return e.context().save();},drawSmallCircleAtPoint:function(bX,bY){var bZ,b0,b1;bZ=[bX,bY];b0=(h(e.cellSide())-2)/2;b1=3.14159265358979*2;e.context().beginPath();e.context().arc(bZ[0],bZ[1],b0,0,b1,true);e.context().closePath();return e.context().stroke();},element:$.Field(function(){var b2,b3;b2=q.Tags();b3=$.New(s,{$:0});return b2.NewTag("canvas",b3);}),initialize:function(b4,b5,b6,b7,b8){var b9,cb;if(t.Equals((b9=e.canvas(),b9.getContext),undefined)){u.initElement(e.canvas());}e.canvas().width=b4;e.canvas().height=b5;e.cellSide=function(){return b6;};e.canvasXOffset=function(){return b7;};e.canvasYOffset=function(){return b8;};e.context().canvas.addEventListener("mousedown",function(b_){return e.setMouseDown(b_);},false);e.context().canvas.addEventListener("mouseup",function(b$){return e.setMouseUp(b$);},false);e.context().canvas.addEventListener("mousemove",function(ca){return e.scrollViewport(ca);},false);e.drawLife(g.currentState().contents);return v.addListener((cb=e.GameEvents(),cb.event),function(cc){if(cc.$==1){return g.stopDrawing();}else{if(cc.$==2){return g.stopDrawingAndReset(function(cd){return e.drawLife(cd);});}else{return g.startDrawing(function(ce){return e.drawLife(ce);});}}});},mouseDownCanvasCoordinates:$.Field(function(){return{$:0};}),nodes:function(){var cf,cg;return w.add(p.Div(r.ofArray([p.Width($$.String(e.canvas().width)),(cf=p.Attr(),cf.NewAttr("style","float:left; clear:both"))])),r.ofArray([w.add(p.Div(r.ofArray([(cg=p.Attr(),cg.NewAttr("style","float:center"))])),r.ofArray([e.element()]))]));},pairMap:function(ch,ci,cj){return($.Tupled(function(ck){return[ch(ck[0]),ch(ck[1])];}))([ci,cj]);},pairMap2:function(cl,cm,cn,co,cp){return(($.Tupled(function(cq){return $.Tupled(function(cr){return[(cl(cr[0]))(cq[0]),(cl(cr[1]))(cq[1])];});}))([cm,cn]))([co,cp]);},pixelsMovedDuring:function(cs,ct){var cu,cv,cw,cx,cy,cB,cC,cD;if(ct.$==1){cu=ct.$0[1];cv=ct.$0[0];cw=e.canvasCoordinatesFromMouseEvent(cs);cx=(cy=function(cz){return function(cA){return cz-cA;};},(cB=[cv,cu],(cC=cB[0],(cD=cB[1],$.Tupled(function(cE){var cF,cG;cF=cE[0];cG=cE[1];return e.pairMap2(cy,cC,cD,cF,cG);})))));return cx(cw);}else{return[0,0];}},previousCanvasCoordinates:$.Field(function(){return{$:0};}),scrollViewport:function(cH){var cI,cJ,cK,cL,cM,cN,cR,cV;if(e.previousCanvasCoordinates().$==1){cI=e.previousCanvasCoordinates();cJ=e.previousCanvasCoordinates().$0[1];cK=e.previousCanvasCoordinates().$0[0];cL=(cM=e.pixelsMovedDuring(cH,cI),(cN=$.Tupled(function(cO){var cP,cQ;cP=cO[0];cQ=cO[1];return e.transformPixelPairToCellPair(cP,cQ);}),cN(cM)));cR=$.Tupled(function(cS){var cT,cU;cT=cS[0];cU=cS[1];return e.updateCellOffsets(cT,cU);});cR(cL);cV=($.Tupled(function(cW){return{$:1,$0:cW};}))(e.canvasCoordinatesFromMouseEvent(cH));e.previousCanvasCoordinates=function(){return cV;};return e.drawLife(g.currentState().contents);}else{return null;}},setMouseDown:function(cX){var cY,cZ,c0;cY=e.canvasCoordinatesFromMouseEvent(cX);cZ={$:1,$0:cY};e.previousCanvasCoordinates=function(){return cZ;};c0={$:1,$0:cY};e.mouseDownCanvasCoordinates=function(){return c0;};},setMouseUp:function(c1){var c2,c3;e.adjustInitArrayAndRedraw(c1);c2={$:0};e.previousCanvasCoordinates=function(){return c2;};c3={$:0};e.mouseDownCanvasCoordinates=function(){return c3;};},transformCellCoordinatesToCanvasCoordinates:function(c4,c5){var c6,c7,c9,c$,da,db,dc,dd,dg,dh,di,dm,dq,du,dv;c6=[c4,c5];c7=function(c8){return c8*e.cellSide();};c9=function(c_){return c_+(e.cellSide()/2>>0);};c$=(da=(db=(dc=(dd=function(de){return function(df){return de-df;};},(dg=[e.cellXOffset(),e.cellYOffset()],(dh=dg[0],(di=dg[1],$.Tupled(function(dj){var dk,dl;dk=dj[0];dl=dj[1];return e.pairMap2(dd,dh,di,dk,dl);}))))),dc(c6)),(dm=$.Tupled(function(dn){var _do,dp;_do=dn[0];dp=dn[1];return e.pairMap(c7,_do,dp);}),dm(db))),(dq=$.Tupled(function(dr){var ds,dt;ds=dr[0];dt=dr[1];return e.pairMap(c9,ds,dt);}),dq(da)));du=(dv=function(dw){return h(dw);},$.Tupled(function(dx){var dy,dz;dy=dx[0];dz=dx[1];return e.pairMap(dv,dy,dz);}));return du(c$);},transformPixelPairToCellPair:function(dA,dB){var dC,dD,dF,dG,dK,dL;dC=[dA,dB];dD=function(dE){return dE/h(e.cellSide());};dF=(dG=$.Tupled(function(dH){var dI,dJ;dI=dH[0];dJ=dH[1];return e.pairMap(dD,dI,dJ);}),dG(dC));dK=(dL=function(dM){return dM<<0;},$.Tupled(function(dN){var dO,dP;dO=dN[0];dP=dN[1];return e.pairMap(dL,dO,dP);}));return dK(dF);},updateCellOffsets:function(dQ,dR){var dS,dT,dU;dS=[dQ,dR];dT=e.cellXOffset()-dS[0];e.cellXOffset=function(){return dT;};dU=e.cellYOffset()-dS[1];e.cellYOffset=function(){return dU;};}}}});$.OnInit(function(){a=$.Safe($$.IntelliFactory.WebSharper);b=$.Safe(a.Control);c=$.Safe(b["FSharpEvent`1"]);d=$.Safe($$.LifeHtml);e=$.Safe(d.Canvas);f=$.Safe($$.Life);g=$.Safe(f.Game);h=$.Safe($$.Number);i=$.Safe($$.Math);j=$.Safe(a.Seq);k=$.Safe(a.Collections);l=$.Safe(k.BalancedTree);m=$.Safe(k["FSharpSet`1"]);n=$.Safe(k.SetModule);o=$.Safe(a.Html);p=$.Safe(o.Default);q=$.Safe(p.HTML5);r=$.Safe(a.List);s=$.Safe(r.T);t=$.Safe(a.Unchecked);u=$.Safe($$.G_vmlCanvasManager);v=$.Safe(a.Util);return w=$.Safe(o.Operators);});$.OnLoad(function(){e.previousCanvasCoordinates();e.mouseDownCanvasCoordinates();e.element();e.context();e.cellYOffset();e.cellXOffset();e.cellSide();e.canvasYOffset();e.canvasXOffset();e.canvas();e.GameEvents();});}());
