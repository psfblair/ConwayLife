(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;$.Define($$,{LifeHtml:{Canvas:{GameEvents:$.Field(function(){return c.New();}),adjustInitArrayAndRedraw:function(w){var x,y;x=(w.clientX-e.canvasXOffset())/e.cellSide()>>0;y=(w.clientY-e.canvasYOffset())/e.cellSide()>>0;return g.toggleCellAndRedraw(x,y,function(z){return e.drawLife(z);});},canvas:$.Field(function(){var A;A=e.element();return A.Body;}),canvasXOffset:$.Field(function(){return 0;}),canvasYOffset:$.Field(function(){return 0;}),cellIsWithinViewableCanvas:function(B,C){var D;D=[B,C];if((D[0]>0?D[0]<h(e.canvas().width):false)?D[1]>0:false){return D[1]<h(e.canvas().height);}else{return false;}},cellSide:$.Field(function(){return 0;}),context:$.Field(function(){return e.canvas().getContext("2d");}),drawLife:function(E){var F,G,H,P,U;e.context().save();e.context().clearRect(0,0,h(e.canvas().width),h(e.canvas().height));e.context().fillStyle="#8EE5EE";e.context().fillRect(0,0,h(e.canvas().width),h(e.canvas().height));e.context().save();e.context().strokeStyle="black";e.context().fillStyle="black";e.context().lineWidth=1;F=(G=(H=function(I){var J,N,O;J=$.Tupled(function(K){var L,M;L=K[0];M=K[1];return e.transformCellCoordinatesToCanvasCoordinates(L,M);});N=i.map(J,I);O=k.OfSeq(N);return l.New1(O);},H(E)),(P=function(Q){return m.Filter($.Tupled(function(R){var S,T;S=R[0];T=R[1];return e.cellIsWithinViewableCanvas(S,T);}),Q);},P(G)));U=function(V){var W;W=$.Tupled(function(X){var Y,Z;Y=X[0];Z=X[1];return e.drawSmallCircleAtPoint(Y,Z);});return i.iter(W,V);};U(F);return e.context().save();},drawSmallCircleAtPoint:function(_0,_1){var _2,_3,_4;_2=[_0,_1];_3=(h(e.cellSide())-2)/2;_4=3.14159265358979*2;e.context().beginPath();e.context().arc(_2[0],_2[1],_3,0,_4,true);e.context().closePath();return e.context().stroke();},element:$.Field(function(){var _5,_6;_5=p.Tags();_6=$.New(r,{$:0});return _5.NewTag("canvas",_6);}),initialize:function(_7,_8,_9,_,ba){var bb,bd;if(s.Equals((bb=e.canvas(),bb.getContext),undefined)){t.initElement(e.canvas());}e.canvas().width=_7;e.canvas().height=_8;e.cellSide=function(){return _9;};e.canvasXOffset=function(){return _;};e.canvasYOffset=function(){return ba;};e.context().canvas.addEventListener("click",function(bc){return e.adjustInitArrayAndRedraw(bc);},false);e.drawLife(g.currentState().contents);return u.addListener((bd=e.GameEvents(),bd.event),function(be){if(be.$==1){return g.stopDrawing();}else{if(be.$==2){return g.stopDrawingAndReset(function(bf){return e.drawLife(bf);});}else{return g.startDrawing(function(bf){return e.drawLife(bf);});}}});},nodes:function(){var bg,bh;return v.add(o.Div(q.ofArray([o.Width($$.String(e.canvas().width)),(bg=o.Attr(),bg.NewAttr("style","float:left; clear:both"))])),q.ofArray([v.add(o.Div(q.ofArray([(bh=o.Attr(),bh.NewAttr("style","float:center"))])),q.ofArray([e.element()]))]));},transformCellCoordinatesToCanvasCoordinates:function(bi,bj){var bk,bl,bm,bn,bp,bq,br;bk=[bi,bj];bl=(bm=bk[0]*e.cellSide()+(e.cellSide()/2>>0),(bn=function(bo){return h(bo);},bn(bm)));bp=(bq=bk[1]*e.cellSide()+(e.cellSide()/2>>0),(br=function(bs){return h(bs);},br(bq)));return[bl,bp];}}}});$.OnInit(function(){a=$.Safe($$.IntelliFactory.WebSharper);b=$.Safe(a.Control);c=$.Safe(b["FSharpEvent`1"]);d=$.Safe($$.LifeHtml);e=$.Safe(d.Canvas);f=$.Safe($$.Life);g=$.Safe(f.Game);h=$.Safe($$.Number);i=$.Safe(a.Seq);j=$.Safe(a.Collections);k=$.Safe(j.BalancedTree);l=$.Safe(j["FSharpSet`1"]);m=$.Safe(j.SetModule);n=$.Safe(a.Html);o=$.Safe(n.Default);p=$.Safe(o.HTML5);q=$.Safe(a.List);r=$.Safe(q.T);s=$.Safe(a.Unchecked);t=$.Safe($$.G_vmlCanvasManager);u=$.Safe(a.Util);return v=$.Safe(n.Operators);});$.OnLoad(function(){e.element();e.context();e.cellSide();e.canvasYOffset();e.canvasXOffset();e.canvas();e.GameEvents();});}());
